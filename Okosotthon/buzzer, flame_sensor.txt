const int FLAME_SENSOR = 2;
const int BUZZER = 3;

bool IsFlameDetected = false;

// State machine enum
enum StateMachine {
    UNARMED,
    ARMED,
    ALARMED,
};

StateMachine currentState = ARMED;

void setup()
{
    Serial.begin(9600);
    delay(2000);

    pinMode(FLAME_SENSOR, INPUT);
    pinMode(BUZZER, OUTPUT);
    pinMode(9, OUTPUT);
    analogWrite(9, 10);
}

void loop()
{
    DetectFlame();

    switch (currentState) {
        case ARMED:
            Armed();
            break;

        case ALARMED:
            Alarmed();
            break;

        case UNARMED:
            Unarmed();
            break;
    }
}

void Unarmed() {
    noTone(BUZZER); // Buzzer OFF
}

void Alarmed() {
    tone(BUZZER, 100);  // Buzzer ON
    delay(1000);        // Riasztás időtartama
    noTone(BUZZER);     // Buzzer OFF
    delay(1000);

}

void Armed() {
    if (IsFlameDetected) {
        currentState = ALARMED;
    }
}

void DetectFlame()
{
    IsFlameDetected = digitalRead(FLAME_SENSOR) == LOW;  // Flame sensor általában LOW jelet ad tűznél
}
